#include <iostream>
#include <windows.h>
using namespace std;

/*
The CPUID instruction is a processor supplementary instruction (its name derived from
CPU IDentification) for the x86 architecture allowing software to discover details of
the processor. By calling CPUID with EAX =1, The 31bit of ECX register if set will
reveal the precense of a hypervisor.
*/
BOOL cpuid_is_hypervisor()
{
	INT CPUInfo[4] = { -1 };

	/* Query hypervisor precense using CPUID (EAX=1), BIT 31 in ECX */
	__cpuid(CPUInfo, 1);
	return ((CPUInfo[2] >> 31) & 1);
}


int main()
{
	cout << "VM detected : " << (cpuid_is_hypervisor() ? "TRUE" : "FALSE") << endl;
	cout << "CipherMode" << endl;
	cout << endl;
}